<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Knowledge Base Search</title>
  <style>
    /* CSS Variables for Dark Theme */
    :root {
      --primary-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      --primary-color: #6366f1;
      --secondary-color: #8b5cf6;
      --bg-dark: #0f172a;
      --bg-darker: #0a0f1c;
      --bg-card: #1e293b;
      --bg-card-light: #334155;
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --text-muted: #94a3b8;
      --border-color: #334155;
      --success-bg: #065f46;
      --success-text: #34d399;
      --error-bg: #7f1d1d;
      --error-text: #f87171;
      --border-radius: 12px;
      --transition: all 0.3s ease;
      --shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      --shadow-light: 0 4px 15px rgba(99, 102, 241, 0.3);
    }
    
    /* Reset and Base Styles */
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-dark);
      min-height: 100vh;
      padding: 20px;
      line-height: 1.6;
      color: var(--text-primary);
    }
    
    /* Container and Layout */
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: var(--bg-card);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      animation: slideUp 0.5s ease;
      border: 1px solid var(--border-color);
    }
    
    /* Animations */
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(99, 102, 241, 0); }
      100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
    }
    
    /* Header */
    .header {
      background: var(--primary-gradient);
      padding: 40px 30px;
      color: white;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
      opacity: 0.3;
    }
    
    .header h1 {
      font-size: clamp(1.8rem, 4vw, 2.5rem);
      margin-bottom: 10px;
      font-weight: 700;
      position: relative;
    }
    
    .header p {
      font-size: clamp(0.9rem, 2vw, 1.1rem);
      opacity: 0.9;
      position: relative;
    }
    
    /* Content Sections */
    .content {
      padding: 40px 30px;
    }
    
    .section {
      margin-bottom: 35px;
      animation: fadeIn 0.6s ease;
    }
    
    .section-title {
      font-size: 1.3em;
      color: var(--text-primary);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .section-title::before {
      content: '';
      width: 4px;
      height: 24px;
      background: var(--primary-gradient);
      border-radius: 2px;
    }
    
    /* File Upload */
    .file-upload-area {
      border: 2px dashed var(--border-color);
      border-radius: var(--border-radius);
      padding: 30px;
      text-align: center;
      transition: var(--transition);
      cursor: pointer;
      background: rgba(30, 41, 59, 0.5);
    }
    
    .file-upload-area:hover,
    .file-upload-area:focus-within {
      border-color: var(--primary-color);
      background: rgba(30, 41, 59, 0.8);
      transform: translateY(-2px);
    }
    
    .file-upload-area.dragover {
      border-color: var(--primary-color);
      background: rgba(99, 102, 241, 0.1);
      animation: pulse 1.5s infinite;
    }
    
    .upload-icon {
      font-size: 3em;
      margin-bottom: 10px;
      opacity: 0.8;
    }
    
    .file-info {
      margin-top: 15px;
      padding: 12px;
      background: rgba(99, 102, 241, 0.1);
      border-radius: 8px;
      display: none;
      color: var(--text-secondary);
      border-left: 3px solid var(--primary-color);
    }
    
    input[type="file"] {
      display: none;
    }
    
    /* Text Inputs and Buttons */
    textarea {
      width: 100%;
      padding: 15px;
      border: 2px solid var(--border-color);
      border-radius: var(--border-radius);
      font-size: 1em;
      font-family: inherit;
      resize: vertical;
      transition: var(--transition);
      background: var(--bg-card-light);
      color: var(--text-primary);
    }
    
    textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      background: var(--bg-card);
    }
    
    textarea::placeholder {
      color: var(--text-muted);
    }
    
    button {
      width: 100%;
      padding: 15px 25px;
      background: var(--primary-gradient);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: var(--shadow-light);
      position: relative;
      overflow: hidden;
    }
    
    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: 0.5s;
    }
    
    button:hover:not(:disabled)::before {
      left: 100%;
    }
    
    button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(99, 102, 241, 0.5);
    }
    
    button:active:not(:disabled) {
      transform: translateY(0);
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    /* Answer Section */
    #answer {
      margin-top: 20px;
      padding: 20px;
      background: var(--bg-card-light);
      border-radius: var(--border-radius);
      border-left: 4px solid var(--primary-color);
      display: none;
      animation: slideIn 0.4s ease;
    }
    
    #answer strong {
      color: var(--primary-color);
      font-size: 1.1em;
      display: block;
      margin-bottom: 10px;
    }
    
    /* Loader */
    .loader {
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-top: 3px solid var(--primary-color);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
      display: none;
    }
    
    /* Status Badges */
    .status-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: 600;
      margin-top: 10px;
    }
    
    .status-success {
      background: var(--success-bg);
      color: var(--success-text);
    }
    
    .status-error {
      background: var(--error-bg);
      color: var(--error-text);
    }
    
    /* Documents List */
    .documents-list {
      margin-top: 15px;
      padding: 15px;
      background: var(--bg-card-light);
      border-radius: 8px;
      display: none;
    }
    
    .document-item {
      padding: 10px;
      background: var(--bg-card);
      margin-bottom: 8px;
      border-radius: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      border: 1px solid var(--border-color);
    }
    
    .delete-btn {
      background: #dc2626;
      color: white;
      border: none;
      padding: 5px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85em;
      width: auto;
      transition: var(--transition);
    }
    
    .delete-btn:hover {
      background: #b91c1c;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .content {
        padding: 25px 20px;
      }
      
      .header {
        padding: 30px 20px;
      }
      
      .file-upload-area {
        padding: 20px;
      }
      
      .document-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      
      .delete-btn {
        align-self: flex-end;
      }
    }
    
    @media (max-width: 480px) {
      body {
        padding: 10px;
      }
      
      .content {
        padding: 20px 15px;
      }
      
      .file-upload-area {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>📚 Knowledge Base Search</h1>
      <p>Upload documents and get instant AI-powered answers</p>
    </div>
    
    <div class="content">
      <div class="section">
        <h2 class="section-title">Upload Document</h2>
        <div class="file-upload-area" id="uploadArea" tabindex="0" role="button" aria-label="Upload document area">
          <div class="upload-icon" aria-hidden="true">📄</div>
          <p style="font-size: 1.1em; margin-bottom: 5px;"><strong>Click to upload</strong> or drag and drop</p>
          <p style="color: var(--text-muted); font-size: 0.9em;">PDF or TXT files supported</p>
          <input type="file" id="fileInput" accept=".pdf,.txt" aria-describedby="fileInfo">
        </div>
        <div class="file-info" id="fileInfo" role="status" aria-live="polite"></div>
        <button onclick="uploadFile()" id="uploadBtn" style="margin-top: 15px;" disabled>Upload & Index Document</button>
        <div class="documents-list" id="docsList" aria-live="polite"></div>
      </div>

      <div class="section">
        <h2 class="section-title">Ask a Question</h2>
        <textarea 
          id="questionInput" 
          rows="4" 
          placeholder="What would you like to know? Ask anything about your uploaded documents..."
          aria-label="Enter your question"
        ></textarea>
        <button onclick="askQuestion()" id="queryBtn" style="margin-top: 15px;" aria-label="Get answer">Get Answer 🔍</button>
        <div class="loader" id="loader" aria-hidden="true"></div>
        <div id="answer" role="region" aria-live="polite"></div>
      </div>
    </div>
  </div>

  <script>
    // DOM Elements
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('fileInfo');
    const uploadBtn = document.getElementById('uploadBtn');
    const loader = document.getElementById('loader');
    const answerDiv = document.getElementById('answer');
    const docsList = document.getElementById('docsList');
    
    // State
    let uploadedDocs = [];

    // Event Listeners
    function initEventListeners() {
      // Click to upload
      uploadArea.addEventListener('click', () => fileInput.click());
      
      // Keyboard navigation for upload area
      uploadArea.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          fileInput.click();
        }
      });

      // Drag and drop
      uploadArea.addEventListener('dragover', handleDragOver);
      uploadArea.addEventListener('dragleave', handleDragLeave);
      uploadArea.addEventListener('drop', handleDrop);

      fileInput.addEventListener('change', handleFileSelect);
      
      // Enter key to submit question
      document.getElementById('questionInput').addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && e.ctrlKey) {
          askQuestion();
        }
      });
    }

    // Drag and Drop Handlers
    function handleDragOver(e) {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    }

    function handleDragLeave() {
      uploadArea.classList.remove('dragover');
    }

    function handleDrop(e) {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        fileInput.files = files;
        handleFileSelect();
      }
    }

    // File Selection Handler
    function handleFileSelect() {
      const file = fileInput.files[0];
      if (file) {
        const fileSize = (file.size / 1024).toFixed(2);
        fileInfo.innerHTML = `
          <strong>📎 Selected:</strong> ${file.name} (${fileSize} KB)
        `;
        fileInfo.style.display = 'block';
        uploadBtn.disabled = false;
      }
    }

    // File Upload Function
    async function uploadFile() {
      const file = fileInput.files[0];
      if (!file) {
        showAlert('Please select a file.');
        return;
      }

      // Validate file type
      const fileType = file.name.split('.').pop().toLowerCase();
      if (!['pdf', 'txt'].includes(fileType)) {
        showAlert('Please select a PDF or TXT file.');
        return;
      }

      uploadBtn.disabled = true;
      uploadBtn.textContent = 'Uploading...';

      const formData = new FormData();
      formData.append('file', file);

      try {
        // Simulate API call for demo purposes
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        // In a real application, you would use:
        // const res = await fetch('http://127.0.0.1:8000/upload', {
        //   method: 'POST',
        //   body: formData
        // });
        // const data = await res.json();
        
        // For demo, simulate success response
        const data = { message: 'Document uploaded and indexed successfully!' };
        
        fileInfo.innerHTML = `<span class="status-badge status-success">✓ ${data.message}</span>`;
        uploadedDocs.push(file.name);
        updateDocsList();
        
        // Reset
        fileInput.value = '';
        uploadBtn.textContent = 'Upload & Index Document';
        uploadBtn.disabled = true;
        
        setTimeout(() => {
          fileInfo.style.display = 'none';
        }, 3000);
      } catch (error) {
        console.error('Upload error:', error);
        fileInfo.innerHTML = `<span class="status-badge status-error">✗ Upload failed. Please try again.</span>`;
        uploadBtn.disabled = false;
        uploadBtn.textContent = 'Upload & Index Document';
      }
    }

    // Update Documents List
    function updateDocsList() {
      if (uploadedDocs.length > 0) {
        docsList.style.display = 'block';
        docsList.innerHTML = '<strong style="display: block; margin-bottom: 10px; color: var(--text-primary);">📚 Indexed Documents:</strong>';
        uploadedDocs.forEach((doc, idx) => {
          const item = document.createElement('div');
          item.className = 'document-item';
          item.innerHTML = `
            <span>${doc}</span>
            <button class="delete-btn" onclick="removeDoc(${idx})" aria-label="Remove ${doc}">Remove</button>
          `;
          docsList.appendChild(item);
        });
      } else {
        docsList.style.display = 'none';
      }
    }

    // Remove Document
    function removeDoc(idx) {
      uploadedDocs.splice(idx, 1);
      updateDocsList();
    }

    // Ask Question Function
    async function askQuestion() {
      const q = document.getElementById('questionInput').value.trim();
      if (!q) {
        showAlert('Please enter a question.');
        return;
      }

      answerDiv.style.display = 'none';
      loader.style.display = 'block';
      document.getElementById('queryBtn').disabled = true;

      try {
        // Simulate API call for demo purposes
        await new Promise(resolve => setTimeout(resolve, 2000));
        
        // In a real application, you would use:
        // const res = await fetch('http://127.0.0.1:8000/query', {
        //   method: 'POST',
        //   headers: { 'Content-Type': 'application/json' },
        //   body: JSON.stringify({ question: q })
        // });
        // const data = await res.json();
        
        // For demo, simulate response
        const sampleAnswers = [
          "Based on the uploaded documents, the information you're looking for appears in section 3.2. The key points are...",
          "The documents indicate that this process involves three main steps: preparation, execution, and verification.",
          "According to the research papers you've uploaded, the consensus is that this approach yields better results in controlled environments.",
          "The documentation suggests implementing this feature requires considering both performance and security aspects."
        ];
        
        const data = { 
          answer: sampleAnswers[Math.floor(Math.random() * sampleAnswers.length)] 
        };
        
        loader.style.display = 'none';
        answerDiv.innerHTML = `<strong>💡 Answer:</strong><p style="margin-top: 10px; line-height: 1.6; color: var(--text-secondary);">${data.answer}</p>`;
        answerDiv.style.display = 'block';
      } catch (error) {
        console.error('Query error:', error);
        loader.style.display = 'none';
        answerDiv.innerHTML = `<strong>❌ Error:</strong><p style="margin-top: 10px; color: var(--error-text);">Failed to get answer. Please try again.</p>`;
        answerDiv.style.display = 'block';
      }
      
      document.getElementById('queryBtn').disabled = false;
    }

    // Utility Functions
    function showAlert(message) {
      
      alert(message);
    }

    // Initialize the application
    document.addEventListener('DOMContentLoaded', initEventListeners);
  </script>
</body>
</html>